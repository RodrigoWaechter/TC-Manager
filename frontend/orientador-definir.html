<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tela Pai</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="css/styles.css" rel="stylesheet">
</head>

<body>

    <div class="container-pai">
        <!-- Topo com botões e nome do usuário -->
        <div class="top-bar d-flex justify-content-between align-items-center mb-3">
            <!-- Botões com largura igual -->
            <div class="d-flex gap-2 flex-grow-1">
                <button type="button" class="btn btn-selected rounded-pill flex-fill">Definir Orientador</button>

                <button type="button" class="btn btn-primary rounded-pill flex-fill"
                    onclick="window.location.href='orientador-desenvolvimento.html'">Desenvolvimento</button>

                <button type="button" class="btn btn-primary rounded-pill flex-fill"
                    onclick="window.location.href='orientador-avalicao.html'">Avaliação</button>
            </div>

            <!-- Botão de calendário  -->
            <div class="ms-2">
                <button type="button" class="btn btn-primary rounded-circle">
                    <i class="bi bi-calendar-event"></i>
                </button>
            </div>

            <div class="ms-3">
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle d-flex align-items-center gap-2" type="button"
                        id="usuarioDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle"></i>
                        <span id="nome-usuario">Carregando...</span>
                    </button>

                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="usuarioDropdown">
                        <li><a class="dropdown-item" href="#">Perfil</a></li>
                        <li><a class="dropdown-item" href="#">Configurações</a></li>
                        <li><a class="dropdown-item" href="#">Sair</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Conteúdo principal que vai mudar nas telas filhas -->
        <div id="conteudo">
            <table class="table table-bordered text-center align-middle">
                    <th colspan="4" class="text-white text-start fs-5 bg-primary">Possíveis Orientados</th>
                    </tr>
                    <tr class="bg-info text-dark">
                        <th style="width: 35%;">Alunos</th>
                        <th style="width: 15%;">Matricula</th>
                        <th style="width: 30%;">Email</th>
                        <th style="width: 20%;">Solicitação</th>
                    </tr>
                </thead>
                <tbody id="tabelaUsuariosBody">
                    <tr>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <tr>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                        <td> </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
        carregarTabelaPossiveisOrientandos();
        carregarNomeUsuario();
    });

    function carregarNomeUsuario() {
            const userInfo = JSON.parse(localStorage.getItem('userInfo'));
            const nomeUsuarioEl = document.getElementById('nome-usuario');
            if (userInfo && userInfo.nome) {
                nomeUsuarioEl.textContent = userInfo.nome;
            } else {
                nomeUsuarioEl.textContent = 'Usuário';
            }
        }

    async function carregarTabelaPossiveisOrientandos() {
        const token = localStorage.getItem('authToken');
        const tbody = document.getElementById('tabelaUsuariosBody');
        
        if (!tbody) { return; }
        tbody.innerHTML = '<tr><td colspan="4">Carregando...</td></tr>';

        if (!token) {
            window.location.href = 'index.html';
            return;
        }

        try {
        
            const response = await fetch('http://localhost:3000/orientador/possiveis-orientandos', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                localStorage.clear();
                window.location.href = 'index.html';
                return;
            }

            const alunos = await response.json();
            tbody.innerHTML = '';

            if (alunos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">Nenhum aluno sem orientador no momento.</td></tr>';
            } else {
                alunos.forEach(aluno => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${aluno.nome}</td>
                        <td>${aluno.matricula}</td>
                        <td>${aluno.email}</td>
                        <td>
                            <button class="btn btn-success btn-sm">Aceitar</button>
                            <button class="btn btn-danger btn-sm">Recusar</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

        } catch (error) {
            console.error('Erro ao buscar possíveis orientandos:', error);
            tbody.innerHTML = '<tr><td colspan="4" class="text-danger">Falha ao carregar os dados.</td></tr>';
        }
    }
    </script>
</body>

</html>